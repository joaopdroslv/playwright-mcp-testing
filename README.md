# End-to-End Webscraping Workflow with Playwright MCP and LLM Calls

This project demonstrates a minimal end-to-end workflow using Playwright MCP (via a custom BrowserMCP wrapper) together with LLM calls to:

- Extract snapshots from real estate listing pages
- Parse items and item details using structured LLM output
- Capture screenshots of each item
- Export all extracted data into an .xlsx file
- Organize the results under a unique runId directory

The implementation uses fastmcp, Playwright, and OpenAI structured outputs.

## Project Flow

The workflow (`items_workflow`) follows these steps:

1. Create a unique `runId` output directory
2. For each configured site (`ITEMS_WORKFLOW_SITES`):
    - Load the initial page
    - Extract a snapshot
    - Detect and iterate pagination
3. For each listing page:
    - Extract a snapshot
    - Use an LLM (`PageItemsOutput`) to detect all items URLs
4. For each item:
    - Extract full detail snapshot
    - Use an LLM (`ItemDetailsOutput`) to parse structured item data
    - Save a screenshot with a unique ID
    - Append the parsed item to the results list

5. After finishing all pages:
    - Write all collected data into a single Excel file inside the `runId` folder

## Output Example

You can find an output example in the `example` dir in the project root.

A run generates:
- Dozens of screenshots (one per extracted item)
- One Excel spreadsheet containing all parsed item data

## How to Run

Follow the steps below to set up the environment and run the example.

1. Configure your `.env` file using `.env.example` as a reference.
   Make sure to set your `OPENAI_API_KEY`.

2. Start the Playwright MCP service:
    ```bash
    docker compose up --build -d playwright-mcp
    ```

3. Build the workflow service:
    ```bash
    docker compose build workflow
    ```

4. Then run the workflow service (It is not a persistent service):
    ```bash
    docker compose up workflow
    ```
    The output generated by the workflow service will be saved in the output/ directory located at the project root.

    `Note:` Since the workflow service is not persistent â€” it runs once and exits after completing the workflow.
    To run the workflow again, use:
    ```bash
    docker compose up workflow
    ```

